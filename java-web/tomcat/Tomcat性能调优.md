## Tomcat性能调优



##### 线程数量设置：

线程数具体设多少，根据具体业务而定，如果你的业务是IO密集型的，比如大量线程等待在数据库读写上，线程数应该设的越高。如果是CPU密集型，完全没有阻塞，设成CPU核数就行

理论上：

线程数=（(线程阻塞时间 + 线程忙绿时间) / 线程忙碌时间) * cpu核数

如果线程始终不阻塞，一直忙碌，会一直占用一个CPU核，因此可以直接设置 线程数=CPU核数。

但是现实中线程可能会被阻塞，比如等待IO。因此根据上面的公式确定线程数。

那怎么确定线程的忙碌时间和阻塞时间？要经过压测，在代码中埋点统计，***TODO***



##### 上下文切换：

线程阻塞会发生线程上下文切换，浪费CPU资源

- 上下文切换（Context Switch）：一个线程被暂停剥夺使用权，另一个线程被选中开始或者继续运行的过程
  切出：一个线程被剥夺处理器的使用权而被暂停运行
  切入：一个线程被选中占用处理器开始运行或者继续运行
  切出切入的过程中，操作系统需要保存和恢复相应的进度信息，这个进度信息就是上下文
