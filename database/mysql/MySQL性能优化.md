## MySQL性能优化



##### 连接数查看

```sql
mysql> show processlist;
```

- Sleep表示空闲连接
- 客户端如果太长时间没动静，连接器就会自动将它断开。这个时间是由参数 wait_timeout 控制 的，默认值是 8 小时



##### 长连接

长连接可减少MySQL建立连接的操作，提升性能，但是存在一个问题：

- MySQL在执行过程中临时使用的内存是管理在连接对象里面的，这些资源会在连接断开的时候才释放，所以如果长连接累积使用下来，会导致内存占用增大
  - 解决：在MySQL5.7版本以后，可以在每次执行一个比较大的操作后，通过执行 mysql_reset_connection 来重新初始化连接资源，这个过程不需要重新连接和校验权限，但是会将连接重置到新创建时的状态



##### 禁用查询缓存

查询缓存失效频繁，只要对一个表进行更新，那么这个表上的所有查询缓存都会被清空，会加大数据库压力，除非你的表是一张静态表

好在 MySQL 也提供了这种“按需使用”的方式。你可以将参数 query_cache_type 设置成 DEMAND，这样对于默认的 SQL 语句都不使用查询缓存。而对于你确定要使用查询缓存的语

```sql
mysql> select SQL_CACHE * from T where ID=10;
```

需要注意的是，**MySQL 8.0 版本直接将查询缓存的整块功能删掉**了，也就是说 8.0 开始彻底没 有这个功能了

