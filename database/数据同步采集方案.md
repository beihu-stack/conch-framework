## 数据同步/采集方案

> ##### 专用型
>
> - canel && otter
> - datax
> - sqoop - 大数据
>
> ##### 通用型
>
> - Flink CDC



### 不停机跟换数据库

<img src="assets/image-20211123212154338.png" alt="image-20211123212154338" style="zoom:35%;" />

- 第一步：实时同步旧库到新库
  - 上线新版订单服务，支持双写新旧库，预留热切换开关：只写旧库，只写新库和同步双写
  - 只开启  只写新库 - **正确运行一两周**，验证新旧订单库中的数据是否一致

<img src="assets/image-20211123212231051.png" alt="image-20211123212231051" style="zoom:35%;" />

- 第二步：开启双写，同时关闭实时同步程序
  - 这个双写的业务逻辑，一定是先写旧库，再写新库，并且以写旧库的结果为准
  - 新旧库数据可能不一致：
    - 一是停止同步程序和开启双写，这两个过程很难做到无缝衔接。
    - 二是双写的策略也不保证新旧库强一致，这时候我们需要上线一个**对比和补偿的程**序，这个程序对比旧库最近的数据变更，然后检查新库中的数据是否一致，如果不一致，还要进行补偿。
  - **稳定运行一两周**

- 第三步：灰度切换读请求到新库，**稳定运行一两周**
- 第四步：停掉对比程序，把订单服务的热开关切换到只写新库，下线旧库，后续订单服务的版本去掉双写功能
